# Contributing
Thank you for checking and considering a contribution to pcsFilter!

## How can contribute?
There are multiple options:
1. [Create a bug report](https://github.com/alex-d-bondarev/pcsFilter/issues/new?template=bug_report.md).
1. [Create a feature request](https://github.com/alex-d-bondarev/pcsFilter/issues/new?template=feature_request.md).
1. [Ask a question](https://github.com/alex-d-bondarev/pcsFilter/issues/new?template=question.md).
1. Help fixing reported issue. See details below:

### Issue workflow
`requires_review` -> `task`
                  \
                   > `wontfix`

All new issues will be created with `requires_review` label.
This labels should later be replaced with `task` for issues that will be worked on.
Otherwise `wontfix` label will be applied.

## Help fixing reported issue.
There are multiple ways you can help with reported issues:
1. No coding help:
   1. Participate in issue discussions.
   1. Help answering existing questions.
1. Help with code:
   1. Update documentation files.
   1. Add a test that fails due to reported issue.
   1. Implement a fix for a reported issue.

### Help with code
If you feel comfortable with code help please fork pcsFilter and create
a branch with a descriptive name.

A good branch name would be (where issue #12 is the ticket you're working on):

```sh
git checkout -b i12-use-isort-api
```

#### Get the test suite running
##### 0. Precondition
**NOTE**: You can skip this section when documentation is changed only.

1. [make](https://www.gnu.org/software/make/) is installed
1. [poetry](https://python-poetry.org/docs/) is installed
1. [nox](https://nox.thea.codes/en/stable/tutorial.html) is installed
1. [pyenv](https://github.com/pyenv/pyenv#installation) is installed.
   - Supported python versions are setup like:
   ```sh
   pyenv install 3.10 3.9 3.8 3.7
   pyenv local 3.10 3.9 3.8 3.7
   ```
1. Install the development dependencies:
   ```sh
   make install
   ```

##### 1. Test project
**NOTE**: You can skip this section when only documentation is changed.

Test the project after each code change by running make:
```sh
make test_all
```

Please commit code changes if any were generated by this command.

### 2. Change the code and/or documentation
There might be a confusion with different parts of the code or test process.
Please feel free to ask any questions as part of issue discussion if you have any.

### 3. Create a Pull Request
At this point, you should switch back to your master branch and make sure it's
up to date with pcsFilter master branch:

```sh
git remote add upstream git@github.com:alex-d-bondarev/pcsFilter.git
git checkout master
git pull upstream master
```

Then update your feature branch from your local copy of master, and push it!

```sh
git checkout i12-use-isort-api
git rebase master
git push --set-upstream origin i12-use-isort-api
```

Go to GitHub and create a Pull Request.  
Wait for GitHub Actions run and ensure that the CI is passing.  
Rerun the tests per [Test project](#1-test-project) section if CI is failing.

### Keeping your Pull Request updated
If a maintainer asks you to "rebase" your PR, they're saying that a lot of code
has changed, and that you need to update your branch so it's easier to merge.

You can perform this by repeating the commands from the [Make a Pull Request section](#make-a-pull-request)
or by executing the following commands:

```sh
git checkout i12-use-isort-api
git pull --rebase upstream master
git push --force-with-lease i12-use-isort-api
```

### Merging a PR (maintainers only)
A PR can only be merged into master by a maintainer if:

* PR template checkboxes were clicked.
* It has no requested changes.
* It is up to date with current master.
* GitHub Actions CI is passing

Any maintainer is allowed to merge a PR if all of these conditions are
met.

### Shipping a release (maintainers only)
Maintainers need to do the following to push out a release:

1. Switch to the master branch and make sure it's up to date.
1. Ensure that all the tests are passing per the [Make a Pull Request section](#make-a-pull-request)
1. Ensure `pyproject.toml` has an unpublished version.
1. Create a tag with the version that matches `pyproject.toml` one:
   ```sh
   export VERSION="X.Y.Z"
   export DESCRIPTION="Short description"
   git tag -a ${VERSION} -m ${DESCRIPTION} && git push origin ${VERSION} 
   ```
1. Ensure that the new version was published to [Test PyPi](https://test.pypi.org/project/pcsfilter/#history)
1. Ensure that the new version was published to [PyPi](https://pypi.org/project/pcsfilter/#history)

### Manual alternative in case of emergency
   ```sh
   # Option no.1
   poetry publish --build --username "__token__" --password $PYPI_TOKEN
   
   # Option no.2
   poetry config pypi-token.pypi $PYPI_TOKEN
   make publish
   ```

## References:
The [activeadmin CONTRIBUTING.md](https://github.com/activeadmin/activeadmin/blob/HEAD/CONTRIBUTING.md) 
was used as basis for the given CONTRIBUTING.md
